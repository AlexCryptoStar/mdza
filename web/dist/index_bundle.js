!function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};t.m=e,t.c=o,t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,o){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var n=o(1),c=r(n),i=o(2),s=r(i);console.log("Hey guys and ladies!!",s.default,c.default)},function(e,t,o){"use strict";function r(){}function n(e,t){var o,n,c,i,s=U;for(i=arguments.length;i-- >2;)E.push(arguments[i]);for(t&&null!=t.children&&(E.length||E.push(t.children),delete t.children);E.length;)if((n=E.pop())&&void 0!==n.pop)for(i=n.length;i--;)E.push(n[i]);else"boolean"==typeof n&&(n=null),(c="function"!=typeof e)&&(null==n?n="":"number"==typeof n?n=String(n):"string"!=typeof n&&(c=!1)),c&&o?s[s.length-1]+=n:s===U?s=[n]:s.push(n),o=c;var a=new r;return a.nodeName=e,a.children=s,a.attributes=null==t?void 0:t,a.key=null==t?void 0:t.key,void 0!==M.vnode&&M.vnode(a),a}function c(e,t){for(var o in t)e[o]=t[o];return e}function i(e,t){return n(e.nodeName,c(c({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}function s(e){!e._dirty&&(e._dirty=!0)&&1==F.push(e)&&(M.debounceRendering||I)(a)}function a(){var e,t=F;for(F=[];e=t.pop();)e._dirty&&k(e)}function u(e,t,o){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&p(e,t.nodeName):o||e._componentConstructor===t.nodeName}function p(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function l(e){var t=c({},e.attributes);t.children=e.children;var o=e.nodeName.defaultProps;if(void 0!==o)for(var r in o)void 0===t[r]&&(t[r]=o[r]);return t}function d(e,t){var o=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return o.normalizedNodeName=e,o}function f(e){var t=e.parentNode;t&&t.removeChild(e)}function h(e,t,o,r,n){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)o&&o(null),r&&r(e);else if("class"!==t||n)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof o||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof o)for(var c in o)c in r||(e.style[c]="");for(var c in r)e.style[c]="number"==typeof r[c]&&!1===A.test(c)?r[c]+"px":r[c]}}else if("dangerouslySetInnerHTML"===t)r&&(e.innerHTML=r.__html||"");else if("o"==t[0]&&"n"==t[1]){var i=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?o||e.addEventListener(t,b,i):e.removeEventListener(t,b,i),(e._listeners||(e._listeners={}))[t]=r}else if("list"!==t&&"type"!==t&&!n&&t in e)v(e,t,null==r?"":r),null!=r&&!1!==r||e.removeAttribute(t);else{var s=n&&t!==(t=t.replace(/^xlink\:?/,""));null==r||!1===r?s?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof r&&(s?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function v(e,t,o){try{e[t]=o}catch(e){}}function b(e){return this._listeners[e.type](M.event&&M.event(e)||e)}function g(){for(var e;e=B.pop();)M.afterMount&&M.afterMount(e),e.componentDidMount&&e.componentDidMount()}function m(e,t,o,r,n,c){q++||(L=null!=n&&void 0!==n.ownerSVGElement,J=null!=e&&!("__preactattr_"in e));var i=y(e,t,o,r,c);return n&&i.parentNode!==n&&n.appendChild(i),--q||(J=!1,c||g()),i}function y(e,t,o,r,n){var c=e,i=L;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||n)?e.nodeValue!=t&&(e.nodeValue=t):(c=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(c,e),O(e,!0))),c.__preactattr_=!0,c;var s=t.nodeName;if("function"==typeof s)return x(e,t,o,r);if(L="svg"===s||"foreignObject"!==s&&L,s=String(s),(!e||!p(e,s))&&(c=d(s,L),e)){for(;e.firstChild;)c.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(c,e),O(e,!0)}var a=c.firstChild,u=c.__preactattr_,l=t.children;if(null==u){u=c.__preactattr_={};for(var f=c.attributes,h=f.length;h--;)u[f[h].name]=f[h].value}return!J&&l&&1===l.length&&"string"==typeof l[0]&&null!=a&&void 0!==a.splitText&&null==a.nextSibling?a.nodeValue!=l[0]&&(a.nodeValue=l[0]):(l&&l.length||null!=a)&&_(c,l,o,r,J||null!=u.dangerouslySetInnerHTML),P(c,t.attributes,u),L=i,c}function _(e,t,o,r,n){var c,i,s,a,p,l=e.childNodes,d=[],h={},v=0,b=0,g=l.length,m=0,_=t?t.length:0;if(0!==g)for(var j=0;j<g;j++){var P=l[j],N=P.__preactattr_,w=_&&N?P._component?P._component.__key:N.key:null;null!=w?(v++,h[w]=P):(N||(void 0!==P.splitText?!n||P.nodeValue.trim():n))&&(d[m++]=P)}if(0!==_)for(var j=0;j<_;j++){a=t[j],p=null;var w=a.key;if(null!=w)v&&void 0!==h[w]&&(p=h[w],h[w]=void 0,v--);else if(!p&&b<m)for(c=b;c<m;c++)if(void 0!==d[c]&&u(i=d[c],a,n)){p=i,d[c]=void 0,c===m-1&&m--,c===b&&b++;break}p=y(p,a,o,r),s=l[j],p&&p!==e&&p!==s&&(null==s?e.appendChild(p):p===s.nextSibling?f(s):e.insertBefore(p,s))}if(v)for(var j in h)void 0!==h[j]&&O(h[j],!1);for(;b<=m;)void 0!==(p=d[m--])&&O(p,!1)}function O(e,t){var o=e._component;o?R(o):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||f(e),j(e))}function j(e){for(e=e.lastChild;e;){var t=e.previousSibling;O(e,!0),e=t}}function P(e,t,o){var r;for(r in o)t&&null!=t[r]||null==o[r]||h(e,r,o[r],o[r]=void 0,L);for(r in t)"children"===r||"innerHTML"===r||r in o&&t[r]===("value"===r||"checked"===r?e[r]:o[r])||h(e,r,o[r],o[r]=t[r],L)}function N(e){var t=e.constructor.name;(V[t]||(V[t]=[])).push(e)}function w(e,t,o){var r,n=V[e.name];if(e.prototype&&e.prototype.render?(r=new e(t,o),S.call(r,t,o)):(r=new S(t,o),r.constructor=e,r.render=C),n)for(var c=n.length;c--;)if(n[c].constructor===e){r.nextBase=n[c].nextBase,n.splice(c,1);break}return r}function C(e,t,o){return this.constructor(e,o)}function T(e,t,o,r,n){e._disable||(e._disable=!0,(e.__ref=t.ref)&&delete t.ref,(e.__key=t.key)&&delete t.key,!e.base||n?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==o&&(1!==o&&!1===M.syncComponentUpdates&&e.base?s(e):k(e,1,n)),e.__ref&&e.__ref(e))}function k(e,t,o,r){if(!e._disable){var n,i,s,a=e.props,u=e.state,p=e.context,d=e.prevProps||a,f=e.prevState||u,h=e.prevContext||p,v=e.base,b=e.nextBase,y=v||b,_=e._component,j=!1;if(v&&(e.props=d,e.state=f,e.context=h,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(a,u,p)?j=!0:e.componentWillUpdate&&e.componentWillUpdate(a,u,p),e.props=a,e.state=u,e.context=p),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!j){n=e.render(a,u,p),e.getChildContext&&(p=c(c({},p),e.getChildContext()));var P,N,C=n&&n.nodeName;if("function"==typeof C){var x=l(n);i=_,i&&i.constructor===C&&x.key==i.__key?T(i,x,1,p,!1):(P=i,e._component=i=w(C,x,p),i.nextBase=i.nextBase||b,i._parentComponent=e,T(i,x,0,p,!1),k(i,1,o,!0)),N=i.base}else s=y,P=_,P&&(s=e._component=null),(y||1===t)&&(s&&(s._component=null),N=m(s,n,p,o||!v,y&&y.parentNode,!0));if(y&&N!==y&&i!==_){var S=y.parentNode;S&&N!==S&&(S.replaceChild(N,y),P||(y._component=null,O(y,!1)))}if(P&&R(P),e.base=N,N&&!r){for(var D=e,E=e;E=E._parentComponent;)(D=E).base=N;N._component=D,N._componentConstructor=D.constructor}}if(!v||o?B.unshift(e):j||(e.componentDidUpdate&&e.componentDidUpdate(d,f,h),M.afterUpdate&&M.afterUpdate(e)),null!=e._renderCallbacks)for(;e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);q||r||g()}}function x(e,t,o,r){for(var n=e&&e._component,c=n,i=e,s=n&&e._componentConstructor===t.nodeName,a=s,u=l(t);n&&!a&&(n=n._parentComponent);)a=n.constructor===t.nodeName;return n&&a&&(!r||n._component)?(T(n,u,3,o,r),e=n.base):(c&&!s&&(R(c),e=i=null),n=w(t.nodeName,u,o),e&&!n.nextBase&&(n.nextBase=e,i=null),T(n,u,1,o,r),e=n.base,i&&e!==i&&(i._component=null,O(i,!1))),e}function R(e){M.beforeUnmount&&M.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var o=e._component;o?R(o):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),e.nextBase=t,f(t),N(e),j(t)),e.__ref&&e.__ref(null)}function S(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{}}function D(e,t,o){return m(o,e,{},!1,t,!1)}Object.defineProperty(t,"__esModule",{value:!0}),o.d(t,"h",function(){return n}),o.d(t,"createElement",function(){return n}),o.d(t,"cloneElement",function(){return i}),o.d(t,"Component",function(){return S}),o.d(t,"render",function(){return D}),o.d(t,"rerender",function(){return a}),o.d(t,"options",function(){return M});var M={},E=[],U=[],I="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,A=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,F=[],B=[],q=0,L=!1,J=!1,V={};c(S.prototype,{setState:function(e,t){var o=this.state;this.prevState||(this.prevState=c({},o)),c(o,"function"==typeof e?e(o,this.props):e),t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),s(this)},forceUpdate:function(e){e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),k(this,2)},render:function(){}});var W={h:n,createElement:n,cloneElement:i,Component:S,render:D,rerender:a,options:M};t.default=W},function(e,t,o){var r,n;!function o(c){function i(e){return"function"==typeof e}function s(e){return null!==e&&"object"==typeof e}function a(e){return Array.isArray(e)}function u(e){return"number"==typeof e}var p={name:"dop",create:o,data:{node_inc:0,node:{},object_inc:1,object:{},collectors:[],gets_collecting:!1,gets_paths:[],computed_inc:0,computed:{},observers_inc:0,observers:{},path:{}},util:{},core:{},protocol:{},transports:{listen:{},connect:{}},cons:{TOKEN:"~TOKEN_DOP",DOP:"~DOP",SEND:"~SEND",DISCONNECT:"~DISCONNECT",REMOTE_FUNCTION:"$DOP_REMOTE_FUNCTION",BROADCAST_FUNCTION:"$DOP_BROADCAST_FUNCTION",COMPUTED_FUNCTION:"$DOP_COMPUTED_FUNCTION"}};p.connect=function(e){var t=Array.prototype.slice.call(arguments,0);return"object"!=p.util.typeof(t[0])&&(e=t[0]={}),"function"!=typeof e.transport&&(e.transport=p.transports.connect.websocket),p.core.connector(t)},p.util.emitter=function(){this._events={}},p.util.emitter.prototype.on=function(e,t,o){return i(t)&&(s(this._events)||(this._events={}),s(this._events[e])||(this._events[e]=[]),this._events[e].push(!0===o?[t,!0]:[t])),this},p.util.emitter.prototype.once=function(e,t){return this.on(e,t,!0)},p.util.emitter.prototype.emit=function(e){if(s(this._events[e])&&this._events[e].length>0){for(var t=0,o=[],r=Array.prototype.slice.call(arguments,1);t<this._events[e].length;t++)o.push(this._events[e][t][0]),!0===this._events[e][t][1]&&(this._events[e].splice(t,1),t-=1);for(t=0;t<o.length;t++)o[t].apply(this,r)}return this},p.util.emitter.prototype.removeListener=function(e,t){if(s(this._events[e])&&this._events[e].length>0)for(var o=0;o<this._events[e].length;o++)this._events[e][o][0]===t&&(this._events[e].splice(o,1),o-=1);return this},p.listen=function(e){var t=Array.prototype.slice.call(arguments,0);return"object"!=p.util.typeof(t[0])&&(e=t[0]={}),"function"!=typeof e.transport&&(e.transport=p.transports.listen.local),new p.core.listener(t)},function(t){function r(e,t,o){function r(e){P.readyState===s?P.send(e):N.push(e)}function p(){if(P.readyState===s)for(;N.length>0;)P.send(N.shift())}function l(){O===a?P.send(_):(P.send(""),O=s),e.core.emitOpen(t,P,o.transport)}function d(o){O===a&&o.data===_?(O=u,e.core.setSocketToNode(t,P),e.core.emitReconnect(t,b),p()):O!==u?(_=o.data,O=u,e.core.setSocketToNode(t,P),r(_),p(),e.core.emitConnect(t)):e.core.emitMessage(t,o.data,o)}function f(){O=i,e.core.emitClose(t,P),e.core.emitDisconnect(t)}function h(){O=i,P.close()}function v(){O===i&&(b=P,P=new j(g),O=a,n(P,l,d,f),c(b,l,d,f))}var b,g="ws://localhost:4444/"+e.name;if("string"==typeof o.url)g=o.url.replace("http","ws");else if("undefined"!=typeof window&&void 0!==window.location&&/http/.test(window.location.href)){var m=/(ss|ps)?:\/\/([^\/]+)\/?(.+)?/.exec(window.location.href),y=m[1]?"wss":"ws";g=y+"://"+m[2].toLocaleLowerCase()+"/"+e.name}var _,O,j=o.transport.getApi(),P=new j(g),N=[];return e.core.setSocketToNode(t,P),O=i,t.reconnect=v,t.on(e.cons.SEND,r),t.on(e.cons.DISCONNECT,h),n(P,l,d,f),P}function n(e,t,o,r){e.addEventListener("open",t),e.addEventListener("message",o),e.addEventListener("close",r)}function c(e,t,o,r){e.removeEventListener("open",t),e.removeEventListener("message",o),e.removeEventListener("close",r)}"object"!=typeof e||!e.exports||"object"==typeof p&&"function"==typeof o&&p.create===o?(r.getApi=function(){return window.WebSocket},void 0!==p?p.transports.connect.websocket=r:t.dopTransportsConnectWebsocket=r):e.exports=r;var i=0,s=1,a=2,u=3}(this),p.util.clone=function(e){return p.isObjectRegistrable(e)?p.util.merge(a(e)?[]:{},e):e},p.util.get=function(e,t){if(0===t.length)return e;for(var o=0,r=t.length;o<r;o++){if(!(o+1<r&&s(e[t[o]])))return e.hasOwnProperty(t[o])?e[t[o]]:void 0;e=e[t[o]]}return e[t[o]]},p.util.invariant=function(e){if(!e){var t=p.util.sprintf.apply(this,Array.prototype.slice.call(arguments,1));throw new Error("[dop] Invariant failed: "+t)}},p.util.merge=function(e,t){var o=arguments;return o.length>2?(Array.prototype.splice.call(o,0,2,p.util.merge.call(this,e,t)),p.util.merge.apply(this,o)):(p.util.path(t,this,e,p.util.mergeMutator),a(t)&&(e.length=t.length),e)},p.util.mergeMutator=function(e,t,o,r){"object"==r||"array"==r?e.hasOwnProperty(t)?e[t]:e[t]="array"==r?[]:{}:e[t]=o},p.util.path=function(e,t,o,r){var n=i(t),c=s(o);return p.util.pathRecursive(e,t,o,r,[],[],n,c),o},p.util.pathRecursive=function(e,t,o,r,n,c,i,s){var a,u,l,d;for(a in e)d=!1,u=e[a],c.push(a),i&&(d=t(e,a,u,o,c,this)),!0!==d&&(l=p.util.typeof(u),s&&(d=r(o,a,u,l,c)),"object"!=l&&"array"!=l||!0===d||u===e||-1!=n.indexOf(u)||!s||void 0===o[a]||(n.push(u),p.util.pathRecursive(u,t,s?o[a]:void 0,r,n,c,i,s)),c.pop())},p.util.sprintf=function(){var e,t=-1,o=arguments[0],r=Array.prototype.slice.call(arguments,1);return o.replace(/"/g,"'").replace(/%([0-9]+)|%s/g,function(){return e=r[void 0===arguments[1]||""===arguments[1]?++t:arguments[1]],void 0===e&&(e=arguments[0]),e})},p.util.swap=function(e,t,o){if(e.length>0&&t.length>1)for(var r,n,c,s=0,a=t.length-1,u=i(o);s<a;s+=2)n=t[s],c=t[s+1],r=e[n],e[n]=e[c],e[c]=r,u&&o(n,c);return e},p.util.typeof=function(e){var t=typeof e;return"object"==t&&(e?a(e)?t="array":e instanceof Date?t="date":e instanceof RegExp&&(t="regexp"):t="null"),t},p.util.uuid=function(){for(var e,t=0,o="";t<32;t++)e=16*Math.random()|0,8!==t&&12!==t&&16!==t&&20!==t||(o+="-"),o+=(12===t?4:16===t?3&e|8:e).toString(16);return o},p.addComputed=function(e,t,o){return p.util.invariant(p.isRegistered(e),"dop.addComputed needs a registered object as first parameter"),p.util.invariant(i(o),"dop.addComputed needs a function as third parameter"),p.core.createComputed(e,t,o,!0,e[t])},p.collect=function(e){p.util.invariant(0==arguments.length||1==arguments.length&&i(e),"dop.collect only accept one argument as function");var t=e?e(p.data.collectors):p.data.collectors.length;return p.core.createCollector(p.data.collectors,t)},p.computed=function(e){return p.util.invariant(i(e),"dop.computed needs a function as first parameter"),function(t,o,r,n){return p.core.createComputed(t,o,e,r,n)}},p.createObserver=function(e){p.util.invariant(i(e),"dop.createObserver only accept one argument as function");var t,o,r,n=p.data.observers;for(t in n)if(n[t].callback===e)return n[t];return o=p.data.observers_inc++,r=new p.core.observer(e,o),n[o]=r},p.decode=function(e,t){var o,r=[],n=0,c=JSON.parse(e,function(e,o){return p.core.decode.call(this,e,o,t,r)});for(o=r.length,n=0;n<o;++n)r[n][0][r[n][1]]=void 0;return c},p.del=function(e,t){return p.isRegistered(e)?void 0!==p.core.delete(e,t):delete e[t]},p.encode=function(e,t){return"function"!=typeof t&&(t=p.core.encode),JSON.stringify(e,t)},p.encodeFunction=function(e){return JSON.stringify(e,p.core.encodeFunction)},p.get=function(e,t){return p.data.gets_collecting&&p.isRegistered(e)&&p.core.proxyObjectHandler.get(p.getObjectTarget(e),t),e[t]},p.getNodeBySocket=function(e){return p.data.node[e[p.cons.TOKEN]]},p.getObjectDop=function(e){return e[p.cons.DOP]},p.getObjectRoot=function(e){return p.getObjectDop(e).r},p.getObjectParent=function(e){return p.getObjectDop(e)._},p.getObjectProxy=function(e){return p.getObjectDop(e).p},p.getObjectTarget=function(e){return p.getObjectDop(e).t},p.getObjectProperty=function(e){var t=p.getObjectDop(e);return a(t._)&&p.getObjectPath(e),t.pr},p.getObjectId=function(e){return p.getObjectProperty(p.getObjectRoot(e))},p.getObjectLevel=function(e){return p.getObjectDop(e).l},p.getObjectPath=function(e,t){for(var o,r,n=[],t=!1!==t,c=e[p.cons.DOP];void 0!==c._;)if(r=c.pr,o=p.getObjectTarget(c._),t&&o[r]!==c.p){if(!a(o))return;if(-1===(r=o.indexOf(c.p)))return;c.pr=r}else n.unshift(r),c=o[p.cons.DOP];return n.unshift(c.pr),n},p.isBroadcastFunction=function(e){return i(e)&&e.name===p.cons.BROADCAST_FUNCTION},p.isObjectRegistrable=function(e){if(null===e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);return t===Object.prototype||t===Array.prototype},p.isRegistered=function(e){return s(e)&&void 0!==p.getObjectDop(e)&&!Object.getOwnPropertyDescriptor(e,p.cons.DOP).enumerable},p.isRemoteFunction=function(e){return i(e)&&e.name===p.cons.REMOTE_FUNCTION},p.onSubscribe=function(e){p.util.invariant(i(e),"dop.onSubscribe only accept a function as parameter"),p.data.onsubscribe=e},p.register=function(e){return p.util.invariant(p.isObjectRegistrable(e)&&!a(e),"dop.register needs a regular plain object as first parameter"),p.isRegistered(e)?p.getObjectProxy(e):p.core.configureObject(e,p.data.object_inc++)},p.removeComputed=function(e,t,o){p.util.invariant(p.isRegistered(e),"dop.removeComputed needs a registered object as first parameter"),p.util.invariant(void 0!==t,"dop.removeComputed needs a string or number as second parameter");var r,n,c,u,l,d,f,h,v,b=p.core.getPathId(p.getObjectPath(e,!1).concat(t)),g=!i(o),m=p.data.path,y=[];if(s(m[b])&&a(m[b].computeds)&&m[b].computeds.length>0)for(n=m[b].computeds,f=0;f<n.length;++f){if(c=n[f],u=p.data.computed[c],r=u.function===o,g||r){for(delete p.data.computed[c],n.splice(n.indexOf(c),1),h=0,v=u.derivations.length;h<v;++h)l=u.derivations[h],d=m[l].derivations,d.splice(d.indexOf(c),1);f-=1,y.push(u.function)}if(r)break}return y},p.set=function(e,t,o){return p.isRegistered(e)?p.core.set(e,t,o):e[t]=o,o},p.setBroadcastFunction=function(e,t){p.util.invariant(p.isRegistered(e),"Object passed to dop.setBroadcastFunction must be a registered object");var o=p.getObjectPath(e),r=o.shift();o.push(t),p.getObjectTarget(e)[t]=function(){return p.protocol.broadcast(r,o,arguments)}},p.core.emitClose=function(e,t){e.listener&&e.listener.emit("close",t),e.emit("close",t)},p.core.emitConnect=function(e){e.connected=!0,e.listener&&e.listener.emit("connect",e),e.emit("connect"),p.core.sendMessages(e)},p.core.emitDisconnect=function(e){e.connected=!1,e.listener&&(p.core.unregisterNode(e),e.listener.emit("disconnect",e)),e.emit("disconnect")},p.core.emitMessage=function(e,t,o){e.listener&&e.listener.emit("message",e,t,o),e.emit("message",t,o);var r;if("string"==typeof t&&"["==t[0])try{r=p.decode(t,e)}catch(e){}else r=t;if(a(r)){"number"==typeof r[0]&&(r=[r]);for(var n,c,u,l,d,f,h,v=0,b=r.length;v<b;v++)if(n=r[v],"number"==typeof(l=n[0])&&0!==l){h=p.util.typeof(n[1]),c="number"==h&&"array"!=h||l<0?[l,n.slice(1)]:c=n;for(var g,m=1,y=c.length;m<y;++m)u=c[m],"array"==p.util.typeof(u)&&("number"==typeof u[0]&&l>0||l<0)&&(f=u[0],g="on"+p.protocol.instructions[f],l>0&&i(p.protocol[g])?p.protocol[g](e,l,u):(l*=-1,s(e.requests[l])&&(d=u,u=e.requests[l],f=u[1],g="_on"+p.protocol.instructions[f],i(p.protocol[g])&&p.protocol[g](e,l,u,d),p.core.deleteRequest(e,l))))}}},p.core.emitOpen=function(e,t,o){var r;return e instanceof p.core.node?r=e:(r=new p.core.node,r.listener=e),r.transport=o,p.core.registerNode(r),e.emit("open",t),r},p.core.emitReconnect=function(e,t,o){e.listener&&(p.core.unregisterNode(o),e.listener.emit("reconnect",e,t)),e.emit("reconnect",t),p.core.sendMessages(e)},p.core.collector=function(e,t){this.active=!0,this.mutations=[],this.queue=e,e.splice(t,0,this)},p.core.collector.prototype.add=function(e){return!(!this.active||void 0!==this.filter&&!0!==this.filter(e))&&(this.mutations.push(e),!0)},p.core.collector.prototype.emit=function(){return this.destroy(),this.emitWithoutDestroy()},p.core.collector.prototype.emitWithoutDestroy=function(){var e=new p.core.snapshot(this.mutations);return e.emit(),this.mutations=[],e},p.core.collector.prototype.pause=function(){this.active=!1},p.core.collector.prototype.resume=function(){this.active=!0},p.core.collector.prototype.destroy=function(){this.active=!1,this.queue.splice(this.queue.indexOf(this),1)},p.core.listener=function(e){p.util.merge(this,new p.util.emitter),e.unshift(p,this),this.options=e[2],this.transport=this.options.transport,this.listener=this.options.transport.apply(this,e)},p.core.node=function(){p.util.merge(this,new p.util.emitter),this.connected=!1,this.request_inc=1,this.requests={},this.message_queue=[],this.subscriber={},this.owner={};do{this.token=p.util.uuid()}while("object"==typeof p.data.node[this.token])},p.core.node.prototype.send=function(e){this.emit(p.cons.SEND,e)},p.core.node.prototype.disconnect=function(){this.emit(p.cons.DISCONNECT)},p.core.node.prototype.subscribe=function(){return p.protocol.subscribe(this,arguments)},p.core.node.prototype.unsubscribe=function(e){return p.protocol.unsubscribe(this,e)},p.core.observer=function(e,t){this.callback=e,this.id=t,this.observers={},this.observers_prop={}},p.core.observer.prototype.observe=function(e,t){p.util.invariant(p.isRegistered(e),"observer.observe() needs a registered object as first parameter");var o=p.getObjectPath(e);p.util.invariant(a(o),"observer.observe() The object you are passing is not allocated to a registered object");var r=p.core.getPathId(o);return data_path=p.data.path,type="observers",2===arguments.length&&(type="observers_prop",r+=p.core.pathSeparator(t)),void 0===data_path[r]&&(data_path[r]={}),void 0===data_path[r][type]&&(data_path[r][type]={}),data_path[r][type][this.id]=!0,this[type][r]=!0,function(){delete data_path[r][type][this.id],delete this[type][r]}.bind(this)},p.core.observer.prototype.destroy=function(){var e,t=p.data.path;delete p.data.observers[this.id];for(e in this.observers)delete t[e].observers[this.id];for(e in this.observers_prop)delete t[e].observers_prop[this.id]},p.core.snapshot=function(e){this.mutations=e,this.forward=!0},p.core.snapshot.prototype.undo=function(){this.forward&&this.mutations.length>0&&(this.forward=!1,this.setPatch(this.getUnpatch()),this.emit())},p.core.snapshot.prototype.redo=function(){!this.forward&&this.mutations.length>0&&(this.forward=!0,this.setPatch(this.getPatch()),this.emit())},p.core.snapshot.prototype.emit=function(){this.mutations.length>0&&p.core.emitToObservers(this.mutations)&&p.core.emitNodes(this.forward?this.getPatch():this.getUnpatch())},p.core.snapshot.prototype.getPatch=function(){return this.patch=void 0===this.patch?p.core.getPatch(this.mutations):this.patch},p.core.snapshot.prototype.getUnpatch=function(){return this.unpatch=void 0===this.unpatch?p.core.getUnpatch(this.mutations):this.unpatch},p.core.snapshot.prototype.setPatch=function(e){for(object_id in e)p.core.setPatch(e[object_id].object,e[object_id].chunks,p.core.setPatchMutator)},p.core.error={reject_local:{OBJECT_NOT_FOUND:"Object not found",NODE_NOT_FOUND:"Node not found",TIMEOUT_REQUEST:"Timeout waiting for response"},reject_remote:{OBJECT_NOT_FOUND:1,1:"Remote object not found or not permissions to use it",SUBSCRIPTION_NOT_FOUND:2,2:"Subscription not found to unsubscribe this object",FUNCTION_NOT_FOUND:3,3:"Remote function not found to be called",CUSTOM_REJECTION:4}},p.core.delete=function(e,t){var o=Object.getOwnPropertyDescriptor(e,t);if(o&&o.configurable){var r,n=p.getObjectTarget(e),c=p.getObjectProxy(e),i=n[t],s=delete n[t];return n!==c&&e!==c||!(r=p.getObjectPath(e))||p.core.storeMutation({object:p.getObjectProxy(n),prop:String(t),path:r,oldValue:p.util.clone(i)}),s}},p.core.pop=function(e){if(0!==e.length){return p.core.splice(e,[e.length-1,1])[0]}},p.core.push=function(e,t){return 0===t.length?e.length:(t.unshift(e.length,0),p.core.splice(e,t),e.length)},p.core.reverse=function(e){var t,o=p.getObjectTarget(e),r=p.getObjectProxy(e);if(o!==r&&e!==r||!(t=p.getObjectPath(e)))Array.prototype.reverse.call(o);else{for(var n,c,i=o.length/2,s=0,a=[];s<i;++s)n=o.length-s-1,s!==n&&(c=o[n],o[n]=o[s],o[s]=c,a.push(s,n));a.length>0&&p.core.storeMutation({object:r,prop:p.getObjectProperty(e),path:t,swaps:a})}return e},p.core.set=function(e,t,o){if(e[t]!==o){var r=Object.getOwnPropertyDescriptor(e,t);if(!r||r&&r.writable){var n,c=p.getObjectTarget(e),s=p.getObjectProxy(e),u=c[t],l=c.length,d=!c.hasOwnProperty(t),f=a(c);if(!p.isObjectRegistrable(o)||p.isRegistered(o)&&p.getObjectParent(o)===s?i(o)&&o.name==p.cons.COMPUTED_FUNCTION?c[t]=o(c,t,!1,u):c[t]=o:c[t]=p.core.configureObject(o,t,s),(c===s||e===s)&&(!i(u)||!i(o))&&(n=p.getObjectPath(e))){var h={object:s,prop:f?String(t):t,path:n,value:p.util.clone(o)};d||(h.oldValue=p.util.clone(u)),c.length!==l&&f&&p.core.storeMutation({object:s,prop:"length",path:n,value:c.length,oldValue:l}),p.core.storeMutation(h)}}}},p.core.shift=function(e){if(0!==e.length){return p.core.splice(e,[0,1])[0]}},p.core.sort=function(e,t){var o,r,n,c=p.getObjectTarget(e),i=p.getObjectProxy(e),s=c.slice(0);return o=Array.prototype.sort.call(c,t),c!==i&&e!==i||!(n=p.getObjectPath(e))||(r=p.core.sortDiff(c,s),r.length>1&&p.core.storeMutation({object:p.getObjectProxy(e),prop:p.getObjectProperty(e),path:n,swaps:r})),o},p.core.sortDiff=function(e,t){for(var o,r,n=t.length,c=[],i=0;i<n;++i)e[i]!==t[i]&&(o=t.indexOf(e[i]),r=t[i],t[i]=t[o],t[o]=r,c.push(i,o));return c},p.core.splice=function(e,t){var o,r,n=p.getObjectTarget(e),c=p.getObjectProxy(e),i=n.length;if(o=Array.prototype.splice.apply(n,t),r=p.getObjectPath(e)){var s,a=t.length,u=n.length,l=2,d=Number(t[0]),f=Number(t[1])>0?t[1]:0,h=t.length>2?t.length-2:0;for(isNaN(d)?d=0:d<0?d=u+d<0?0:u+d:d>i&&(d=i),1===a?0:a>2&&f===h?d+f:n.length;l<a;++l,++d)s=t[l],p.isObjectRegistrable(s)&&(n[d]=p.core.configureObject(s,d,c));if((n===c||e===c)&&(i!==u||h>0)){t[0]<0&&(t[0]=e.length+t[0]);var v={object:c,prop:p.getObjectProperty(e),path:r,splice:t};o.length>0&&(v.spliced=p.util.clone(o)),u!==i&&(v.oldLength=i),p.core.storeMutation(v)}}return o},p.core.swap=function(e,t){var o=p.getObjectTarget(e),r=p.getObjectProxy(e),n=p.util.swap(o,t);return o!==r&&e!==r||p.core.storeMutation({object:r,prop:p.getObjectProperty(e),path:p.getObjectPath(e),swaps:t.slice(0)}),n},p.core.unshift=function(e,t){return 0===t.length?e.length:(t.unshift(0,0),p.core.splice(e,t),e.length)};var l="function"==typeof Proxy;p.core.configureObject=function(e,t,o){if(p.isRegistered(e))return p.core.configureObject(p.util.clone(e),t,o);var r,n,c={};c._=o,c.pr=a(o)?Number(t):t,l?(r=c.p=new Proxy(e,p.core.proxyObjectHandler),n=c.t=e):r=n=c.p=c.t=e,c.r=void 0===o?r:p.getObjectDop(o).r,Object.defineProperty(n,p.cons.DOP,{value:c,enumerable:!1,configurable:!1,writable:!1});var s,u,d,f,h=a(n);for(s in n)h&&(s=Number(s)),u=n[s],f=i(u),f&&u.name==p.core.createRemoteFunction.name?(d=p.getObjectPath(e),n[s]=u(d[0],d.slice(1).concat(s))):f&&u.name==p.cons.COMPUTED_FUNCTION?n[s]=u(r,s,!1,void 0):p.isObjectRegistrable(u)&&(n[s]=p.core.configureObject(u,s,r));return"array"==p.util.typeof(n)&&Object.defineProperties(n,p.core.proxyArrayHandler),r},p.core.createCollector=function(e,t){return new p.core.collector(e,t)},p.core.createComputed=function(e,t,o,r,n){var c=p.data.path,i=p.data.computed_inc++,s={object_root:p.getObjectRoot(e),prop:t,function:o,derivations:[]},a=p.getObjectPath(e,!1);return s.path=a.slice(1),s.pathid=p.core.getPathId(a.concat(t)),void 0===c[s.pathid]&&(c[s.pathid]={}),void 0===c[s.pathid].computeds&&(c[s.pathid].computeds=[]),p.data.computed[i]=s,value=p.core.updateComputed(i,s,e,n),r&&p.core.set(e,t,value),value},p.core.emitToObservers=function(e){for(var t,o,r,n={},c=!1,i=p.data.path,a=0,u=e.length;a<u;++a){if(t=e[a],o=t.path_id,!c&&s(p.data.object[p.getObjectId(t.object)])&&(c=!0),void 0!==i[o]&&void 0!==i[o].observers)for(r in i[o].observers)void 0===n[r]&&(n[r]=[]),n[r].push(t);if(void 0===t.swaps&&(o+=p.core.pathSeparator(void 0===t.splice?t.prop:"length"),void 0!==i[o]&&void 0!==i[o].observers_prop))for(r in i[o].observers_prop)void 0===n[r]&&(n[r]=[]),-1==n[r].indexOf(t)&&n[r].push(t)}for(r in n)p.data.observers[r].callback(n[r]);return c},p.core.getMutationInverted=function(e){var t={object:e.object,path:e.path,prop:e.prop};if(void 0!==e.splice){var o=e.splice,r=void 0===e.spliced?[]:e.spliced;t.splice=[o[0],o.length-2],Array.prototype.push.apply(t.splice,r),t.spliced=o.slice(2),0===t.spliced.length&&delete t.spliced}else void 0!==e.swaps?t.swaps=e.swaps.slice(0).reverse():e.hasOwnProperty("oldValue")?e.hasOwnProperty("value")?(t.oldValue=e.value,t.value=e.oldValue):t.value=e.oldValue:t.oldValue=e.value;return t},p.core.getPatch=function(e,t){for(var o,r,n={},c=0,i=e.length;c<i;++c)o=t?p.core.getMutationInverted(e[c]):e[c],r=p.getObjectId(o.object),void 0===n[r]&&(n[r]={chunks:[{}],object:p.getObjectRoot(o.object)}),p.core.injectMutationInPatch(n[r],o);return n},p.core.getPathId=function(e){for(var t=0,o=e.length,r="";t<o;++t)r+=p.core.pathSeparator(e[t]);return r},p.core.getUnpatch=function(e){return p.core.getPatch(e.slice(0).reverse(),!0)},p.core.injectMutationInPatch=function(e,t){for(var o,r,n,c,i,s=t.prop,l=t.path,d=t.value,f=void 0!==t.splice,h=void 0!==t.swaps,v=f||h,b=p.util.typeof(d),g=1,m=chunkParent=e.chunks[e.chunks.length-1],y=chunkNextParent=chunkNextRoot={},_=p.protocol.instructionsPatchs,O=!1,j=!1;g<l.length;++g)n=l[g],chunkParent=m,chunkNextParent=y,y=y[n]={},o=p.util.typeof(m[n]),"array"==o?(r=m[n],r[0]===_.object?(O=!0,m=r[1]):(!v||v&&g+1<l.length)&&(j=!0,m=y,e.chunks.push(chunkNextRoot))):!j&&v&&"object"==o?(chunkParent=chunkNextParent,m=y,e.chunks.push(chunkNextRoot)):m="object"==o?m[n]:m[n]={};"object"==b||"array"==b?(c=p.util.merge("array"==b?[]:{},d),m[s]=O?c:[_.object,c]):v?O?f?Array.prototype.splice.apply(m,t.splice.slice(0)):p.util.swap(m,t.swaps.slice(0)):(i=f?[_.splice,t.splice.slice(0)]:[_.swaps,t.swaps.slice(0)],a(chunkParent[s])?(u(chunkParent[s][0])&&(chunkParent[s]=[chunkParent[s]]),chunkParent[s].push(i)):chunkParent[s]=i):m[s]=d},p.core.pathSeparator=function(e){return e+"."+e},p.core.proxyArrayHandler={splice:{value:function(){return p.core.splice(this,Array.prototype.slice.call(arguments,0))}},shift:{value:function(){return p.core.shift(this,Array.prototype.slice.call(arguments,0))}},pop:{value:function(){return p.core.pop(this,Array.prototype.slice.call(arguments,0))}},push:{value:function(){return p.core.push(this,Array.prototype.slice.call(arguments,0))}},unshift:{value:function(){return p.core.unshift(this,Array.prototype.slice.call(arguments,0))}},reverse:{value:function(){return p.core.reverse(this)}},sort:{value:function(e){return p.core.sort(this,e)}}},p.core.proxyObjectHandler={set:function(e,t,o){return p.core.set(p.getObjectProxy(e),t,o),!0},deleteProperty:function(e,t){return void 0!==p.core.delete(p.getObjectProxy(e),t)},get:function(e,t){return p.data.gets_collecting&&"string"==typeof t&&t!==p.cons.DOP&&e[t]!==Array.prototype[t]&&p.data.gets_paths.push(p.getObjectPath(e,!1).concat(t)),e[t]}},p.core.runDerivations=function(e){if(void 0!==p.data.path[e]&&void 0!==p.data.path[e].derivations)for(var t,o,r,n=p.data.path[e].derivations,c=n.length,i=0;i<c;++i)o=n[i],t=p.data.computed[o],void 0!==(r=p.util.get(t.object_root,t.path))&&p.core.set(r,t.prop,p.core.updateComputed(o,t,r,r[t.prop]))},p.core.setPatch=function(e,t,o){a(t)||(t=[t]);for(var r=0,n=t.length;r<n;++r)p.util.path(t[r],null,e,o);return e},p.core.setPatchFunctionMutator=function(e,t,o,r,n){if(!i(o)||o.name!=p.core.createRemoteFunction.name)return p.core.setPatchMutator(e,t,o,r,n);p.set(e,t,o(p.getObjectId(e),n.slice(0)))},p.core.setPatchMutator=function(e,t,o,r,n){var c,i,s=(p.util.typeof(e),p.util.typeof(e[t]),p.protocol.instructionsPatchs);if("array"==r){if((c=o[0])===s.object)p.set(e,t,p.util.clone(o[1]));else if(a(e[t])){a(c)||(o=[o]);for(var u=0,l=o.length;u<l;++u)i=o[u],i[0]===s.splice?p.core.splice(e[t],i[1]):i[0]===s.swaps&&p.core.swap(e[t],i[1])}return!0}"undefined"==r?p.del(e,t):"object"!=r&&p.set(e,t,o)},p.core.storeMutation=function(e){var t,o=p.data.collectors,r=0,n=o.length;for(t=e.path_id=p.core.getPathId(e.path),void 0===e.splice&&void 0===e.swaps&&(t+=p.core.pathSeparator(e.prop));r<n;r++)if(o[r].add(e))return p.core.runDerivations(t);new p.core.snapshot([e]).emit(),p.core.runDerivations(t)},p.core.updateComputed=function(e,t,o,r){var n,c,i,s,a,u,l,d=p.data.path,f=t.derivations,h=0;for(p.data.gets_collecting=!0,s=t.function.call(o,r),p.data.gets_collecting=!1,n=p.data.gets_paths,p.data.gets_paths=[],a=n.length;h<a;++h)for(c=n[h],i="",u=0,l=c.length;u<l;++u)i+=p.core.pathSeparator(c[u]),u>0&&(void 0===d[i]&&(d[i]={}),void 0===d[i].derivations&&(d[i].derivations=[]),d[i].derivations.indexOf(e)<0&&(d[i].derivations.push(e),f.push(i)));return-1===d[t.pathid].computeds.indexOf(e)&&d[t.pathid].computeds.push(e),s},p.core.connector=function(e){var t=new p.core.node;return e.unshift(p,t),t.options=e[2],t.transport=t.options.transport,t.options.transport.apply(this,e),t},p.core.createAsync=function(){var e,t,o=new Promise(function(o,r){e=o,t=r});return o.resolve=e,o.reject=t,o},p.core.createRemoteFunction=function(e){return function(t,o){return function(){return p.protocol.call(e,t,o,arguments)}}},p.core.createRequest=function(e){var t=e.request_inc++,o=Array.prototype.slice.call(arguments,1);return e.requests[t]=o,o.unshift(t),o.promise=p.core.createAsync(),o},p.core.createResponse=function(){return arguments[0]=-1*arguments[0],Array.prototype.slice.call(arguments,0)};var d=/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d.\d\d\dZ$/,f=/\/(.+)\/([gimuy]{0,5})/;if(p.core.decode=function(e,t,o,r){if("string"==typeof t){if(t==p.protocol.instructionsPatchs.function)return p.core.createRemoteFunction(o);if(t==p.protocol.instructionsPatchs.undefined&&s(r))return void r.push([this,e]);if(t==p.protocol.instructionsPatchs.infinity)return 1/0;if(t==p.protocol.instructionsPatchs._infinity)return-1/0;if(t==p.protocol.instructionsPatchs.nan)return NaN;if(d.exec(t))return new Date(t);if(t.substr(0,2)==p.protocol.instructionsPatchs.regex){var n=f.exec(t.substr(2));return new RegExp(n[1],n[2])}if("~"==t[0])return t.substring(1)}return t},p.core.deleteRequest=function(e,t){clearTimeout(e.requests[t].timeout),delete e.requests[t]},p.core.emitNodes=function(e){var t,o,r,n,c;for(t in e)if(s(p.data.object[t])){n=p.data.object[t];for(o in n.node)1===n.node[o].subscriber&&(r=p.data.node[o],c=e[t].chunks,p.protocol.patch(r,Number(t),c.length>1?c:c[0]))}},p.core.encode=function(e,t){var o=typeof t;return"undefined"==o?p.protocol.instructionsPatchs.undefined:"string"==o&&"~"==t[0]?"~"+t:"number"==o&&isNaN(t)?p.protocol.instructionsPatchs.nan:"object"==o&&t instanceof RegExp?p.protocol.instructionsPatchs.regex+t.toString():t===1/0?p.protocol.instructionsPatchs.infinity:t===-1/0?p.protocol.instructionsPatchs._infinity:t},p.core.encodeFunction=function(e,t){return i(t)&&!p.isBroadcastFunction(t)?p.protocol.instructionsPatchs.function:p.core.encode(e,t)},p.core.getRejectError=function(e){if("number"==typeof e&&void 0!==p.core.error.reject_remote[e]){var t=Array.prototype.slice.call(arguments,1);return t.unshift(p.core.error.reject_remote[e]),p.util.sprintf.apply(this,t)}return e},p.core.localProcedureCall=function(e,t,o,r,n,c){var s,a=p.core.createAsync();i(n)&&(a=n(a)),t.push(a),a.then(o).catch(r),(s=e.apply(c||a,t))!==a&&a.resolve(s)},p.core.registerNode=function(e){p.data.node[e.token]=e},p.core.registerObjectToNode=function(e,t){var o,r=p.getObjectId(t);return void 0===p.data.object[r]&&(p.data.object[r]={object:t,nodes_total:0,node:{}}),o=p.data.object[r],void 0===o.node[e.token]&&(o.nodes_total+=1,o.node[e.token]={subscriber:0,owner:0,version:0,pending:[],applied_version:0,applied:{}}),o},p.core.registerOwner=function(e,t,o){var r=p.core.registerObjectToNode(e,t),n=p.getObjectId(r.object);r.node[e.token].owner=o,e.owner[o]=n},p.core.registerSubscriber=function(e,t){var o=p.core.registerObjectToNode(e,t),r=p.getObjectId(o.object);return e.subscriber[r]=!0,!o.node[e.token].subscriber&&(o.node[e.token].subscriber=1,!0)},p.core.sendMessages=function(e){var t=e.message_queue.length;if(t>0&&e.connected){for(var o,r,n,c=0,i=[];c<t;++c)if(r=e.message_queue[c][0],i.push(e.message_queue[c][1](r)),(n=r[0])>0){var s=p.protocol.instructions[r[1]];r.timeout=setTimeout(function(){p.protocol["on"+s+"timeout"](e,n,r),delete e.requests[n]},p.protocol.timeouts[s])}o=c>1?"["+i.join(",")+"]":i[0],e.message_queue=[],e.send(o)}},p.core.setSocketToNode=function(e,t){e.socket=t,t[p.cons.TOKEN]=e.token},p.core.storeMessage=function(e,t,o){"function"!=typeof o&&(o=p.encode),e.message_queue.push([t,o])},p.core.storeSendMessages=function(e,t,o){p.core.storeMessage(e,t,o),p.core.sendMessages(e)},p.core.unregisterNode=function(e){var t,o,r;for(t in e.subscriber)void 0!==(r=p.data.object[t])&&void 0!==r.node[e.token]&&(r.nodes_total-=1,delete r.node[e.token]);for(o in e.owner)t=e.owner[o],void 0!==(r=p.data.object[t])&&void 0!==r.node[e.token]&&(r.nodes_total-=1,delete r.node[e.token]);void 0!==r&&0===r.nodes_total&&delete p.data.object[t],delete p.data.node[e.token]},p.protocol._onbroadcast=function(e,t,o,r){p.protocol._oncall(e,t,o,r)},p.protocol._oncall=function(e,t,o,r){var n=r[0],c=o.promise;void 0!==n&&(0===n?c.resolve(r[1]):n===p.core.error.reject_remote.CUSTOM_REJECTION?c.reject(r[1]):c.reject(p.core.getRejectError(n)))},p.protocol._onpatch=function(e,t,o,r){var n,c=r[0],i=o[2],s=p.data.object[i].node[e.token],a=o[3],u=s.pending,l=o.promise,d=0,f=u.length;if(void 0!==c)if(0===c){for(;d<f;d++){if((n=u[d][0])>=a){n===a&&u.splice(d,1);break}p.protocol.patchSend(e,i,n,u[d][1])}l.resolve(r[1])}else l.reject(p.core.getRejectError(c))},p.protocol._onsubscribe=function(e,t,o,r){if(void 0!==r[0])if(0!==r[0])o.promise.reject(p.core.getRejectError(r[0]));else{var n,c,i="number"==typeof r[1]?[r[1]]:r[1],u=i[0],l=r[2];a(i)&&"number"==typeof u?(void 0===e.owner[u]?(c=p.collect(),n=p.isRegistered(o.into)?p.core.setPatch(o.into,l,p.core.setPatchFunctionMutator):p.register(void 0===o.into?l:p.core.setPatch(o.into,l,p.core.setPatchMutator)),p.core.registerOwner(e,n,u),c.emit()):n=p.data.object[e.owner[u]].object,n=p.util.get(n,i.slice(1)),s(n)?o.promise.resolve(p.getObjectProxy(n)):o.promise.reject(p.core.error.reject_local.OBJECT_NOT_FOUND)):o.promise.reject(p.core.error.reject_local.OBJECT_NOT_FOUND)}},p.protocol._onunsubscribe=function(e,t,o,r){if(void 0!==r[0])if(0!==r[0])o.promise.reject(r[0]);else{var n=o[2],c=e.owner[n],i=p.data.object[c];if(s(i)&&s(i.node[e.token])&&i.node[e.token].owner===n){var a=i.node[e.token];a.owner=0,0===a.subscriber&&(i.nodes_total-=1),0===i.nodes_total&&delete p.data.object[c],o.promise.resolve()}}},p.protocol.broadcast=function(e,t,o){var r=p.data.object[e],n=[];if(s(r)&&s(r.node)){var c,i,a,u=r.node;o=Array.prototype.slice.call(o,0);for(c in u)1===u[c].subscriber&&(i=p.data.node[c],a=p.core.createRequest(i,p.protocol.instructions.broadcast,e,t,o),a.promise.node=i,p.core.storeSendMessages(i,a),n.push(a.promise))}return n},p.protocol.call=function(e,t,o,r){var n=p.data.object[t];if(s(n)&&s(n.node[e.token])&&n.node[e.token].owner>0){r=Array.prototype.slice.call(r,0);var c=p.core.createRequest(e,p.protocol.instructions.call,n.node[e.token].owner,o,r);return p.core.storeSendMessages(e,c),c.promise}return Promise.reject(p.core.error.reject_local.NODE_NOT_FOUND)},p.protocol.instructions={subscribe:1,unsubscribe:2,call:3,broadcast:4,patch:5,1:"subscribe",2:"unsubscribe",3:"call",4:"broadcast",5:"patch"},p.protocol.instructionsPatchs={undefined:"~U",function:"~F",object:2,splice:3,swaps:4,nan:"~N",regex:"~R",infinity:"~I",_infinity:"~i"},p.protocol.onbroadcast=function(e,t,o){p.protocol.onfunction(e,t,o,e.owner[o[1]],function(e){return e.owner===o[1]})},p.protocol.oncall=function(e,t,o){p.protocol.onfunction(e,t,o,o[1],function(e){return 1===e.subscriber})},p.protocol.onfunction=function(e,t,o,r,n){function c(o){var r=p.core.createResponse(t,0);return void 0!==o&&r.push(o),p.core.storeSendMessages(e,r),o}function a(o){p.core.storeSendMessages(e,p.core.createResponse(t,p.core.error.reject_remote.CUSTOM_REJECTION,o))}var u=o[2],l=o[3],d=p.data.object[r];if(s(d)&&s(d.node[e.token])&&n(d.node[e.token])){var f=u.pop(),h=p.util.get(d.object,u),v=h[f];if(i(v)&&!p.isBroadcastFunction(v))return void(p.isRemoteFunction(v)?v.apply(null,l).then(c).catch(a):p.core.localProcedureCall(v,l,c,a,function(t){return t.node=e,t},p.getObjectProxy(h)))}p.core.storeSendMessages(e,p.core.createResponse(t,p.core.error.reject_remote.FUNCTION_NOT_FOUND))},p.protocol.onpatch=function(e,t,o){var r,n,c=o[1],i=e.owner[c],a=o[2],u=o[3],l=p.core.createResponse(t),d=p.data.object[i];if(s(d)&&s(d.node[e.token])&&d.node[e.token].owner===c){if(r=d.node[e.token],r.applied_version<a&&void 0===r.applied[a]){for(r.applied[a]=u,n=p.collect();r.applied[r.applied_version+1];)r.applied_version+=1,p.core.setPatch(d.object,r.applied[r.applied_version],p.core.setPatchFunctionMutator),delete r.applied[r.applied_version];n.emit()}l.push(0)}else l.push(p.core.error.reject_remote.OBJECT_NOT_FOUND);p.core.storeSendMessages(e,l)},p.protocol.onpatchtimeout=function(e,t,o){p.protocol.patchSend(e,o[2],o[3],o[4])},p.protocol.onsubscribe=function(e,t,o){function r(o){var r=p.core.createResponse(t);o instanceof Error?console.log(o.stack):r.push(o),p.core.storeSendMessages(e,r,JSON.stringify)}if(i(p.data.onsubscribe)){var n=Array.prototype.slice.call(o,1);p.core.localProcedureCall(p.data.onsubscribe,n,function(o){if(p.isObjectRegistrable(o)){var r=p.register(o),n=p.getObjectRoot(r),c=p.getObjectPath(r),i=c[0],s=p.core.createResponse(t,0);return p.core.registerSubscriber(e,n)?s.push(i,n):s.push(c),p.core.storeSendMessages(e,s,p.encodeFunction),r}if(void 0===o)return Promise.reject(p.core.error.reject_remote.OBJECT_NOT_FOUND);p.util.invariant(!1,"dop.onsubscribe callback must return or resolve a regular object")},r,function(t){return t.node=e,t})}else r(p.core.error.reject_remote.OBJECT_NOT_FOUND)},p.protocol.onsubscribetimeout=p.protocol.onunsubscribetimeout=p.protocol.oncalltimeout=p.protocol.onbroadcasttimeout=function(e,t,o){o.promise.reject(p.core.error.reject_local.TIMEOUT_REQUEST)},p.protocol.onunsubscribe=function(e,t,o){var r=o[1],n=p.data.object[r],c=p.core.createResponse(t);if(s(n)&&s(n.node[e.token])&&n.node[e.token].subscriber){var i=n.node[e.token];i.subscriber=0,0===i.owner&&(n.nodes_total-=1),0===n.nodes_total&&delete p.data.object[r],c.push(0)}else c.push(p.core.error.reject_remote.SUBSCRIPTION_NOT_FOUND);p.core.storeSendMessages(e,c)},p.protocol.patch=function(e,t,o){var r=p.data.object[t].node[e.token],n=++r.version;return r.pending.push([n,p.util.merge({},o)]),p.protocol.patchSend(e,t,n,o)},p.protocol.patchSend=function(e,t,o,r){var n=p.core.createRequest(e,p.protocol.instructions.patch,t,o,r);return p.core.storeSendMessages(e,n,p.encodeFunction),n.promise},p.protocol.subscribe=function(e,t){t=Array.prototype.slice.call(t,0),t.unshift(e,p.protocol.instructions.subscribe);var o=p.core.createRequest.apply(e,t);return o.promise.into=function(e){return p.isObjectRegistrable(e)&&(o.into=p.isRegistered(e)?p.getObjectProxy(e):e),o.promise},p.core.storeSendMessages(e,o),o.promise},p.protocol.timeouts={subscribe:5e3,unsubscribe:5e3,call:1e4,broadcast:1e4,patch:1e3},p.protocol.unsubscribe=function(e,t){var o=p.getObjectId(t),r=p.data.object[o];if(s(r)&&s(r.node[e.token])&&r.node[e.token].owner>0){var n=p.core.createRequest(e,p.protocol.instructions.unsubscribe,r.node[e.token].owner);return p.core.storeSendMessages(e,n),n.promise}return Promise.reject(p.core.error.reject_remote[2])},void 0===c)return p;r=[],void 0!==(n=function(){return p}.apply(t,r))&&(e.exports=n)}(this)}]);